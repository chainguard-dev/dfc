FROM myorg/alpine:latest AS builder

WORKDIR /app
COPY . .

# Install build dependencies
RUN apk add -U build-essential ca-certificates git

# Build the application
RUN go build -o app

FROM builder AS test
# In this stage we run tests
RUN go test ./...

FROM myorg/alpine:latest AS prod

# Install runtime dependencies
RUN apk add -U ca-certificates curl nginx

# Copy the application from the builder stage
COPY --from=builder /app/app /app

# Set up the application
WORKDIR /app
ENV PATH="/app:${PATH}"

# Run the application
CMD ["app"] 